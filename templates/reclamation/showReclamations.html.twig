{# Ajouter ce code dans votre template Twig #}

{% extends 'base2.html.twig' %}

{% block title %}Liste des Réclamations{% endblock %}

{% block body %}
<style>
  /* Custom style for the search container */
.search-container {
  position: relative;
  width: 100%;
}

/* Style for the search input */
.cool-input {
  padding-right: 30px; /* Space for the search icon */
}

/* Style for the search icon */
.search-icon {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
}

/* Additional style for the select dropdown */
.custom-select {
  height: calc(2.25rem + 2px);
}

</style>

<section class="page-title bg-1" style="margin-bottom:5%;">
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div class="block text-center">
            <span class="text-white">your</span>
            <h1 class="text-capitalize mb-5 text-lg">Reaclamations</h1>
  
            <!-- <ul class="list-inline breadcumb-nav">
              <li class="list-inline-item"><a href="index.html" class="text-white">Home</a></li>
              <li class="list-inline-item"><span class="text-white">/</span></li>
              <li class="list-inline-item"><a href="#" class="text-white-50">Our blog</a></li>
            </ul> -->
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="container">
    <h1 class="text-center mb-4">Liste des Réclamations</h1>

    {# Afficher les messages flash de type 'warning' #}
    <div class="appoinment-wrap mt-5 mt-lg-0 pl-lg-5">
        {% if app.session.flashBag.has('warning') %}
            <div class="alert alert-warning" role="alert">
                {{ app.session.flashBag.get('warning')[0] }}
            </div>
        {% endif %}
    </div>

    {# Formulaire de recherche avancée #}
    {{ form_start(form) }}
    <div class="row mb-3">
      <div class="col-md-6">
        <div class="search-container" style="margin-top: 5.5%;">
          <input type="text" id="searchInput" placeholder="Rechercher le sujet" class="form-control cool-input">
          <span class="search-icon"><i class="fa fa-search"></i></span>
        </div>
      </div>
      <div class="col-md-6">
        {{ form_row(form.category, { 'attr': {'class': 'form-select'} }) }}
      </div>
    </div>
    <div class="row mb-3">
      <div class="col-md-6" >
        {{ form_row(form.submissionDate, { 'attr': {'class': 'form-control', 'placeholder': 'Date de soumission'} }) }}
      </div>
      <div class="col-md-6">
        {# Ajouter le champ Nom et Prénom #}
        {{ form_row(form.nom, { 'style': 'border-radius: 50px;','value': app.user.fullname , 'label': 'Nom et Prénom', 'attr': {'placeholder': 'Entrez votre nom et prénom'} }) }}
      </div>
    </div>
    <div class="d-grid">
      <button type="submit" class="btn btn-success" style="border-radius: 50px;">Rechercher</button>
    </div>
   
    {{ form_end(form) }}

    {# Affichage des réclamations de l'utilisateur #}
    {% if reclamations is empty %}
      <p class="text-center mt-4">Aucune réclamation n'a été trouvée.</p>
    {% else %}
      <div class="table-responsive mt-4">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>ID</th>
              <th>Catégorie</th>
              <th>Sujet</th>
              <th>Description</th>
              <th>Nom et Prénom</th> {# Ajout de la colonne Nom et Prénom #}
              <th>Date de Soumission</th>
              <th>Editer</th>
              <th>Supprimer</th>
              <th>Réponse</th>
              <th>Générer PDF</th>
            </tr>
          </thead>
          <tbody>
            {% for reclamation in reclamations %}
              <tr>
                <td>{{ reclamation.id }}</td>
                <td>{{ reclamation.categorie }}</td>
                <td>{{ reclamation.sujet }}</td>
                <td>{{ reclamation.description }}</td>
                <td>{{ reclamation.nom }}</td> {# Affichage du nom de l'utilisateur #}
                <td>{{ reclamation.subdate ? reclamation.subdate|date('Y-m-d H:i:s') : 'Non spécifiée' }}</td>
                <td>
                  <a href="{{ path('edit_reclamation', { 'id': reclamation.id }) }}" class="btn btn-primary btn-sm"><i class="fa-solid fa-pen-to-square fa-beat-fade fa-xl"></i></a>
                </td>
                <td>
                  <a href="{{ path('delete_reclamation', { 'id': reclamation.id }) }}" class="btn btn-danger btn-sm" onclick="return confirm('Êtes-vous sûr de vouloir supprimer cette réclamation ?')"><i class="fa-regular fa-trash-can fa-bounce fa-xl" style="color: #ffffff;"></i></a>
                </td>
                <td>
                  <a href="{{ path('show_dbreplies', { 'id': reclamation.id }) }}" class="btn btn-success btn-sm"><i class="fa-solid fa-magnifying-glass fa-shake fa-xl" style="color: #fcfcfc;"></i></a>
                </td>
                <td>
                  <a href="{{ path('generate_pdf', { 'id': reclamation.id }) }}" class="btn btn-info btn-sm">PDF</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}

    {# Bouton pour afficher les statistiques #}
   <!-- <a href="{{ path('test') }}" class="btn btn-info d-block mx-auto mt-4">Voir les Statistiques</a>-->

    <a href="{{ path('add_reclamation') }}" class="btn btn-primary  " style="margin-bottom: 5%; border-radius: 50px; margin-left: 430px;">Ajouter une Réclamation</a>
  </div>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#searchInput').on('input', function() {
                var query = $(this).val().toLowerCase();
                $('.table tbody tr').each(function() {
                    var row = $(this);
                    var sujet = row.find('td:eq(2)').text().toLowerCase();
                    if (sujet.includes(query)) {
                        row.fadeIn(300);
                    } else {
                        row.fadeOut(300);
                    }
                });
            }); 
        });
    </script>
{% endblock %}
